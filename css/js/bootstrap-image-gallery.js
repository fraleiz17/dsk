!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","bootstrap"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.extend(e.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var i=e.fn.modal.Constructor.prototype.show,o=e.fn.modal.Constructor.prototype.hide;e.extend(e.fn.modal.Constructor.prototype,{initLinks:function(){var t=this,i=this.options,o=i.selector||"a[data-target="+i.target+"]";this.$links=e(i.delegate).find(o).filter(i.filter).each(function(e){t.getUrl(this)===i.href&&(i.index=e)}),this.$links[i.index]||(i.index=0)},getUrl:function(t){return t.href||e(t).data("href")},getDownloadUrl:function(t){return e(t).data("download")},startSlideShow:function(){var e=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){e.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var e=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=e.data("slideshow")||5e3,this.startSlideShow()),e.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var t,i,o=this.options,n=o.index+o.preloadRange+1;for(i=o.index-o.preloadRange;n>i;i+=1)t=this.$links[i],t&&i!==o.index&&e("<img>").prop("src",this.getUrl(t))},loadImage:function(){var e,i=this,o=this.$element,n=this.options.index,l=this.getUrl(this.$links[n]),s=this.getDownloadUrl(this.$links[n]);this.abortLoad(),this.stopSlideShow(),o.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){o.addClass("modal-loading")},100),e=o.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){e.remove()},3e3),o.find(".modal-title").text(this.$links[n].title),o.find(".modal-download").prop("href",s||l),this._loadingImage=t(l,function(e){i.img=e,window.clearTimeout(i._loadingTimeout),o.removeClass("modal-loading"),o.trigger("load"),i.showImage(e),i.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(t){var i,o,n=this.$element,l=e.support.transition&&n.hasClass("fade"),s=l?n.animate:n.css,a=n.find(".modal-image");a.css({width:t.width,height:t.height}),n.find(".modal-title").css({width:Math.max(t.width,380)}),l&&(i=n.clone().hide().appendTo(document.body)),e(window).width()>767?s.call(n.stop(),{"margin-top":-((i||n).outerHeight()/2),"margin-left":-((i||n).outerWidth()/2)}):n.css({top:(e(window).height()-(i||n).outerHeight())/2}),i&&i.remove(),a.append(t),o=t.offsetWidth,n.trigger("display"),l?n.is(":visible")?e(t).on(e.support.transition.end,function(i){i.target===t&&(e(t).off(e.support.transition.end),n.trigger("displayed"))}).addClass("in"):(e(t).addClass("in"),n.one("shown",function(){n.trigger("displayed")})):(e(t).addClass("in"),n.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var e=this.options;e.index-=1,e.index<0&&(e.index=this.$links.length-1),this.loadImage()},next:function(){var e=this.options;e.index+=1,e.index>this.$links.length-1&&(e.index=0),this.loadImage()},keyHandler:function(e){switch(e.which){case 37:case 38:e.preventDefault(),this.prev();break;case 39:case 40:e.preventDefault(),this.next()}},wheelHandler:function(e){e.preventDefault(),e=e.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=e.wheelDelta||e.detail||0,e.wheelDelta&&this._wheelCounter>=120||!e.wheelDelta&&this._wheelCounter<0?(this.prev(),this._wheelCounter=0):(e.wheelDelta&&this._wheelCounter<=-120||!e.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var t=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(i){var o=e(this);1===t.$links.length?t.hide():(i.pageX-o.offset().left)/o.width()<t.options.imageClickDivision?t.prev(i):t.next(i)}),i.find(".modal-prev").on("click.modal-gallery",function(e){t.prev(e)}),i.find(".modal-next").on("click.modal-gallery",function(e){t.next(e)}),i.find(".modal-slideshow").on("click.modal-gallery",function(e){t.toggleSlideShow(e)}),e(document).on("keydown.modal-gallery",function(e){t.keyHandler(e)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(e){t.wheelHandler(e)})},destroyGalleryEvents:function(){var t=this.$element;this.abortLoad(),this.stopSlideShow(),t.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),e(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var t=this.$element,o=this.options,n=e(window).width(),l=e(window).height();t.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:n,maxHeight:l,canvas:o.canvas},t.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=n,this._loadImageOptions.minHeight=l)):this._loadImageOptions={maxWidth:n-o.offsetWidth,maxHeight:l-o.offsetHeight,canvas:o.canvas},n>767?t.css({"margin-top":-(t.outerHeight()/2),"margin-left":-(t.outerWidth()/2)}):t.css({top:(e(window).height()-t.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(t.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),t.toggleClass("modal-single",1===this.$links.length),this.loadImage())}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),o.apply(this,arguments)}}),e(function(){e(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(t){var i,o=e(this),n=o.data(),l=e(n.target),s=l.data("modal");s||(n=e.extend(l.data(),n)),n.selector||(n.selector="a[data-gallery=gallery]"),i=e(t.target).closest(n.selector),i.length&&l.length&&(t.preventDefault(),n.href=i.prop("href")||i.data("href"),n.delegate=i[0]!==this?this:document,s&&e.extend(s.options,n),l.modal(n))})})});
