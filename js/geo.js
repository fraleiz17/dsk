function handleBlackBerryLocation(){if(bb_successCallback&&bb_errorCallback){if(0==blackberry.location.latitude&&0==blackberry.location.longitude)bb_errorCallback({message:"Position unavailable",code:2});else{var e=null;blackberry.location.timestamp&&(e=new Date(blackberry.location.timestamp)),bb_successCallback({timestamp:e,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}parseFloat(navigator.appVersion)>=4.6&&blackberry.location.removeLocationUpdate(),bb_successCallback=null,bb_errorCallback=null}}var bb_successCallback,bb_errorCallback,geo_position_js=function(){var e={},o=null;return e.getCurrentPosition=function(e,t,a){o.getCurrentPosition(e,t,a)},e.init=function(){try{"undefined"!=typeof geo_position_js_simulator?o=geo_position_js_simulator:"undefined"!=typeof bondi&&"undefined"!=typeof bondi.geolocation?o=bondi.geolocation:"undefined"!=typeof window.google&&"undefined"!=typeof window.google.gears?(o=google.gears.factory.create("beta.geolocation"),e.getCurrentPosition=function(e,t,a){function n(o){e("undefined"!=typeof o.latitude?{timestamp:o.timestamp,coords:{latitude:o.latitude,longitude:o.longitude}}:o)}try{o.getCurrentPosition(n,t,a)}catch(i){t({message:i,code:1})}}):"undefined"!=typeof navigator.geolocation?(o=navigator.geolocation,e.getCurrentPosition=function(e,t,a){function n(o){e("undefined"!=typeof o.latitude?{timestamp:o.timestamp,coords:{latitude:o.latitude,longitude:o.longitude}}:o)}o.getCurrentPosition(n,t,a)},e.watchPosition=function(t,a,n){try{o.watchPosition(t,a,n),e.clearWatch=function(e){"undefined"!=typeof o.clearWatch&&o.clearWatch(e)}}catch(i){a({message:i,code:1})}}):"undefined"!=typeof Mojo&&"undefined"!=typeof Mojo.Service&&"Mojo.Service.Request"!=typeof Mojo.Service.Request?(o=!0,e.getCurrentPosition=function(e,o,t){parameters={},t&&(t.enableHighAccuracy&&1==t.enableHighAccuracy&&(parameters.accuracy=1),t.maximumAge&&(parameters.maximumAge=t.maximumAge),t.responseTime&&(t.responseTime<5?parameters.responseTime=1:t.responseTime<20?parameters.responseTime=2:parameters.timeout=3)),r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:parameters,onSuccess:function(o){e({timestamp:o.timestamp,coords:{latitude:o.latitude,longitude:o.longitude,heading:o.heading}})},onFailure:function(e){o(1==e.errorCode?{code:3,message:"Timeout"}:2==e.errorCode?{code:2,message:"Position Unavailable"}:{code:0,message:"Unknown Error: webOS-code"+errorCode})}})}):"undefined"!=typeof device&&"undefined"!=typeof device.getServiceObject?(o=device.getServiceObject("Service.Location","ILocation"),e.getCurrentPosition=function(e,t,a){function n(o,a,n){4==a?t({message:"Position unavailable",code:2}):e({timestamp:null,coords:{latitude:n.ReturnValue.Latitude,longitude:n.ReturnValue.Longitude,altitude:n.ReturnValue.Altitude,heading:n.ReturnValue.Heading}})}var i=new Object;i.LocationInformationClass="BasicLocationInformation",o.ILocation.GetLocation(i,n)}):"undefined"!=typeof window.blackberry&&blackberry.location.GPSSupported&&(blackberry.location.setAidMode(2),e.getCurrentPosition=function(e,o,t){bb_successCallback=e,bb_errorCallback=o,parseFloat(navigator.appVersion)>=4.6?blackberry.location.onLocationUpdate(handleBlackBerryLocation()):blackberry.location.onLocationUpdate("handleBlackBerryLocation()"),blackberry.location.refreshLocation()},o=blackberry.location)}catch(t){"undefined"!=typeof console&&console.log(t)}return null!=o},e}();
